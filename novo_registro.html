<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Diário Animado</title>
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#2F3C7E',
            secondary: '#D8D4F2',
            accent: '#A2D5AB',
            neutral: '#F7F7F7',
          },
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
          },
          animation: {
            fadeIn: 'fadeIn 1.2s ease-out forwards',
            bounceIn: 'bounceIn 1s ease-out forwards',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: 0 },
              '100%': { opacity: 1 },
            },
            bounceIn: {
              '0%': { transform: 'scale(0.9)', opacity: 0 },
              '60%': { transform: 'scale(1.05)', opacity: 1 },
              '100%': { transform: 'scale(1)' },
            },
          },
        },
      },
    };
  </script>
  <style>
    .diary-textarea {
      width: 100%;
      height: 300px;
      border: 2px dashed #ff6b6b;
      border-radius: 15px;
      padding: 15px;
      font-size: 1.1em;
      resize: none;
      transition: all 0.3s;
      background: rgba(255, 255, 255, 0.7);
      color: #333;
    }
    
    .dark .diary-textarea {
      background: rgba(30, 30, 30, 0.7);
      color: #fff;
      border-color: #4ca1af;
    }
    
    .diary-textarea:focus {
      border: 2px solid #ff6b6b;
      box-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
      outline: none;
    }
    
    .emoji-btn {
      font-size: 1.5em;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .emoji-btn:hover {
      transform: scale(1.2);
    }
    
    .mood-btn {
      background: none;
      border: none;
      font-size: 2em;
      cursor: pointer;
      margin: 0 5px;
    }
    
    .confetti {
      position: fixed;
      top: -10px;
      width: 10px;
      height: 10px;
      opacity: 1;
      z-index: 9999;
      animation: confettiFall linear forwards;
    }
    
    @keyframes confettiFall {
      to {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-neutral to-secondary dark:from-gray-900 dark:to-gray-800 font-sans min-h-screen flex items-center justify-center px-4 transition-colors duration-500">
  <button id="themeToggle" class="absolute top-4 right-4 bg-primary text-white px-4 py-2 rounded-full shadow-md hover:bg-blue-900 transition">
    🌙 Modo Escuro
  </button>

  <!-- Dashboard Principal -->
  <div id="dashboard" class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 text-center max-w-md animate-fadeIn transition-all duration-300 transform hover:scale-[1.01]">
    <h2 class="text-2xl text-primary dark:text-white font-bold mb-4">Seu Diário Pessoal</h2>
    <p class="text-gray-700 dark:text-gray-300 mb-6">Aqui você pode registrar seus pensamentos, memórias e sonhos.</p>
    
    <div class="flex flex-col items-center gap-3">
      <button id="newEntryBtn" class="bg-accent text-primary py-2 px-6 rounded-full shadow-md hover:bg-green-400 transition">Iniciar Novo Registro</button>
      <input type="file" id="fileInput" accept=".txt" class="hidden" />
      
    </div>
  </div>

  <!-- Formulário de Registro -->
  <div id="entryForm" class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-3xl animate-fadeIn transition-all duration-300">
    <h2 class="text-2xl text-primary dark:text-white font-bold mb-4 text-center">
      🌟 Novo Registro Feliz 🌟
    </h2>
    
    <div class="text-primary dark:text-white mb-4 text-center" id="current-date"></div>
    
    <div class="mood-selector text-center mb-4">
      <p class="text-gray-700 dark:text-gray-300 mb-2">Como está seu humor hoje?</p>
      <button class="mood-btn" onclick="setMood('😊')">😊</button>
      <button class="mood-btn" onclick="setMood('😂')">😂</button>
      <button class="mood-btn" onclick="setMood('🥰')">🥰</button>
      <button class="mood-btn" onclick="setMood('😎')">😎</button>
      <button class="mood-btn" onclick="setMood('🤩')">🤩</button>
    </div>

    <div class="emoji-picker flex justify-center gap-3 mb-4">
      <span class="emoji-btn" onclick="insertEmoji('😊')">😊</span>
      <span class="emoji-btn" onclick="insertEmoji('🌈')">🌈</span>
      <span class="emoji-btn" onclick="insertEmoji('🎉')">🎉</span>
      <span class="emoji-btn" onclick="insertEmoji('✨')">✨</span>
      <span class="emoji-btn" onclick="insertEmoji('🌸')">🌸</span>
    </div>

    <input
      id="entryTitle"
      type="text"
      placeholder="Título do seu dia"
      class="w-full p-2 mb-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-black dark:text-white"
    />
    
    <textarea
      id="entryText"
      class="diary-textarea"
      placeholder="Escreva aqui sobre seu dia feliz..."
    ></textarea>

    <div class="flex justify-center gap-4 mt-6">
      <button
        id="saveEntryBtn"
        class="bg-primary text-white py-2 px-6 rounded-full hover:bg-blue-800 transition flex items-center gap-2"
      >
        <span>💾</span> Salvar como TXT
      </button>
      <button onclick="document.getElementById('fileInput').click()" class="bg-blue-500 text-white py-2 px-6 rounded-full shadow-md hover:bg-blue-600 transition mt-2">
        📂 Abrir Registro
      </button>
      <button
        id="celebrateBtn"
        class="bg-accent text-primary py-2 px-6 rounded-full hover:bg-green-400 transition flex items-center gap-2"
      >
        <span>🎉</span> Celebrar!
      </button>
      <button
        id="cancelEntryBtn"
        class="bg-gray-500 text-white py-2 px-6 rounded-full hover:bg-gray-600 transition flex items-center gap-2"
      >
        <span>✖</span> Cancelar
      </button>
      
        
    </div>
  </div>

  <script>
    // Elementos do DOM
    const dashboard = document.getElementById("dashboard");
    const entryForm = document.getElementById("entryForm");

    const newEntryBtn = document.getElementById("newEntryBtn");
    const saveEntryBtn = document.getElementById("saveEntryBtn");
    const celebrateBtn = document.getElementById("celebrateBtn");
    const cancelEntryBtn = document.getElementById("cancelEntryBtn");

    // Alternar tema
    const themeToggle = document.getElementById("themeToggle");
    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      if (document.body.classList.contains("dark")) {
        themeToggle.textContent = "☀️ Modo Claro";
      } else {
        themeToggle.textContent = "🌙 Modo Escuro";
      }
    });

    // Efeito de confetes
    function celebrate() {
      for (let i = 0; i < 100; i++) {
        createConfetti();
      }
      alert('Você é incrível! 🎉');
    }

    function createConfetti() {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + 'vw';
      confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
      confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
      confetti.style.width = Math.random() * 10 + 5 + 'px';
      confetti.style.height = confetti.style.width;
      confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
      document.body.appendChild(confetti);
      
      setTimeout(() => {
        confetti.remove();
      }, 5000);
    }

    // Funções para o diário
    function setMood(mood) {
      document.getElementById("entryText").value += mood;
    }

    function insertEmoji(emoji) {
      const textarea = document.getElementById("entryText");
      const startPos = textarea.selectionStart;
      const endPos = textarea.selectionEnd;
      const text = textarea.value;
      
      textarea.value = text.substring(0, startPos) + emoji + text.substring(endPos);
      textarea.focus();
      textarea.selectionStart = textarea.selectionEnd = startPos + emoji.length;
    }

    // Mostrar data atual
    function showCurrentDate() {
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const today = new Date();
      document.getElementById('current-date').textContent = today.toLocaleDateString('pt-BR', options);
      return today.toISOString().split('T')[0]; // Retorna a data no formato YYYY-MM-DD
    }

    // Função para salvar como arquivo TXT
    function saveAsTxt(title, content) {
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_${new Date().toISOString().split('T')[0]}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Eventos dos botões
    newEntryBtn.addEventListener("click", () => {
      document.getElementById("entryTitle").value = "";
      document.getElementById("entryText").value = "";
      showCurrentDate();
      dashboard.classList.add("hidden");
      entryForm.classList.remove("hidden");
    });

    cancelEntryBtn.addEventListener("click", () => {
      entryForm.classList.add("hidden");
      dashboard.classList.remove("hidden");
    });

    saveEntryBtn.addEventListener("click", () => {
      const title = document.getElementById("entryTitle").value.trim();
      const text = document.getElementById("entryText").value.trim();

      if (!title || !text) {
        alert("Por favor, preencha título e descrição.");
        return;
      }

      // Formata o conteúdo do arquivo
      const dateStr = showCurrentDate();
      const content = `Título: ${title}\nData: ${dateStr}\n\n${text}`;
      
      // Salva como arquivo TXT
      saveAsTxt(title, content);
      
      alert("Registro salvo como arquivo TXT!");
      entryForm.classList.add("hidden");
      dashboard.classList.remove("hidden");
    });

    // Conecta o evento ao botão Celebrar
    celebrateBtn.addEventListener("click", celebrate);

    // Mostra apenas o dashboard inicialmente
    dashboard.classList.remove("hidden");
    entryForm.classList.add("hidden");
  
    // NOVO: Manipulador para abrir arquivos TXT
const fileInput = document.getElementById('fileInput');

fileInput.addEventListener('change', () => {
  const file = fileInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    const content = e.target.result;
    
    // Abrir tela de edição e preencher campos
    dashboard.classList.add("hidden");
    entryForm.classList.remove("hidden");

    // Extrai título, data e conteúdo do arquivo
    const lines = content.split('\n');
    let title = '';
    let date = '';
    let text = '';
    
    if (lines.length > 0 && lines[0].startsWith('Título:')) {
      title = lines[0].replace('Título:', '').trim();
    }
    
    if (lines.length > 1 && lines[1].startsWith('Data:')) {
      date = lines[1].replace('Data:', '').trim();
    }
    
    // O restante é o conteúdo
    if (lines.length > 2) {
      text = lines.slice(2).join('\n').trim();
    }

    document.getElementById('entryTitle').value = title;
    document.getElementById('entryText').value = text;
    document.getElementById('current-date').textContent = date || showCurrentDate();
  };

  reader.readAsText(file);
});


</script>
</body>
</html>