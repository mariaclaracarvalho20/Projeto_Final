<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Diário Animado</title>
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#2F3C7E",
              secondary: "#D8D4F2",
              accent: "#A2D5AB",
              neutral: "#F7F7F7",
            },
            fontFamily: {
              sans: ["Poppins", "sans-serif"],
            },
            animation: {
              fadeIn: "fadeIn 1.2s ease-out forwards",
              bounceIn: "bounceIn 1s ease-out forwards",
            },
            keyframes: {
              fadeIn: {
                "0%": { opacity: 0 },
                "100%": { opacity: 1 },
              },
              bounceIn: {
                "0%": { transform: "scale(0.9)", opacity: 0 },
                "60%": { transform: "scale(1.05)", opacity: 1 },
                "100%": { transform: "scale(1)" },
              },
            },
          },
        },
      };
    </script>
    <style>
      .confetti {
        position: fixed;
        top: 0;
        width: 10px;
        height: 10px;
        opacity: 0.9;
        border-radius: 50%;
        animation-name: confettiFall;
        animation-timing-function: linear;
        animation-iteration-count: 1;
      }
      @keyframes confettiFall {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
          opacity: 0;
        }
      }
    </style>
  </head>

  <body
    class="bg-gradient-to-br from-neutral to-secondary font-sans min-h-screen flex items-center justify-center px-4"
    id="mainBody"
  >
    <!-- Tela inicial -->
    <div
      id="intro"
      class="bg-white rounded-2xl shadow-2xl p-8 text-center animate-fadeIn max-w-md transition-all duration-300 transform hover:scale-[1.01]"
    >
      <img
        src="https://cdn-icons-png.flaticon.com/512/742/742751.png"
        alt="Ícone do diário"
        class="mx-auto w-24 h-24 mb-6 animate-bounceIn drop-shadow-xl"
      />
      <h1 class="text-3xl text-primary font-bold mb-3">
        Olá, bem-vindo(a) ao Diário Animado
      </h1>
      <p class="text-gray-700 mb-6 text-base">
        Um lugar seguro e moderno para registrar seus pensamentos, memórias e sonhos ✨
      </p>
      <button
        id="startBtn"
        class="bg-accent hover:bg-green-400 text-primary font-medium py-2 px-6 rounded-full shadow-md transition transform hover:scale-105"
      >
        Começar agora
      </button>
    </div>

    <!-- Formulário de login -->
    <div
      id="loginForm"
      class="hidden bg-white rounded-2xl shadow-2xl p-8 text-center max-w-md animate-fadeIn transition-all duration-300 transform hover:scale-[1.01]"
    >
      <h2 class="text-2xl text-primary font-bold mb-6">
        Login
      </h2>
      
      <div class="mb-4 relative">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <svg class="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
          </svg>
        </div>
        <input
          id="loginEmail"
          type="email"
          placeholder="Email"
          class="pl-10 w-full p-3 border border-gray-300 rounded-lg bg-white text-black focus:ring-2 focus:ring-primary focus:border-transparent transition"
        />
      </div>
      
      <div class="mb-6 relative">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <svg class="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <input
          id="loginPassword"
          type="password"
          placeholder="Senha"
          class="pl-10 w-full p-3 border border-gray-300 rounded-lg bg-white text-black focus:ring-2 focus:ring-primary focus:border-transparent transition"
        />
      </div>
    </div>

    <!-- Dashboard do usuário -->
    <div
      id="dashboard"
      class="hidden bg-white rounded-2xl shadow-2xl p-8 max-w-md animate-fadeIn transition-all duration-300 transform hover:scale-[1.01]"
    >
      <h2 class="text-2xl text-primary font-bold mb-4 text-center">
        Bem-vindo(a), <span id="userName"></span>!
      </h2>
      <p class="text-gray-700 mb-6 text-center">
        Aqui você pode registrar seus pensamentos, memórias e sonhos.
      </p>

      <div class="flex flex-col items-center gap-3">
        <button
          id="newEntryBtn"
          class="bg-accent text-primary py-2 px-6 rounded-full shadow-md hover:bg-green-400 transition"
        >
          Iniciar Novo Registro
        </button>
        <button
          id="logoutBtn"
          class="bg-primary text-white py-2 px-6 rounded-full hover:bg-blue-800 transition"
        >
          Sair
        </button>
      </div>

      <!-- Área de registros -->
      <div id="entriesList" class="mt-6 max-h-96 overflow-y-auto"></div>
    </div>

    <!-- Modal para novo registro -->
    <div
      id="entryModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden"
    >
      <div class="bg-white rounded-lg p-6 max-w-lg w-full">
        <h3 class="text-lg font-semibold mb-4 text-primary">
          <span id="modalTitle">Novo Registro</span>
        </h3>
        <textarea
          id="entryText"
          class="w-full p-2 border border-gray-300 rounded-md bg-white text-black"
          rows="5"
          placeholder="Escreva aqui seu pensamento, memória ou sonho..."
        ></textarea>
        <div class="mt-4 flex justify-end gap-3">
          <button
            id="cancelEntryBtn"
            class="px-4 py-2 rounded-full border border-primary text-primary hover:bg-primary hover:text-white transition"
          >
            Cancelar
          </button>
          <button
            id="saveEntryBtn"
            class="px-4 py-2 rounded-full bg-primary text-white hover:bg-blue-800 transition"
          >
            Salvar
          </button>
        </div>
        <input type="hidden" id="currentEntryId" value="">
      </div>
    </div>

    <!-- Confetes -->
    <div id="confettiContainer" class="fixed inset-0 pointer-events-none"></div>

    <script>
      // Elementos
      const intro = document.getElementById("intro");
      const loginForm = document.getElementById("loginForm");
      const dashboard = document.getElementById("dashboard");
      const userNameSpan = document.getElementById("userName");
      const entriesList = document.getElementById("entriesList");
      const entryModal = document.getElementById("entryModal");
      const entryText = document.getElementById("entryText");
      const modalTitle = document.getElementById("modalTitle");
      const currentEntryId = document.getElementById("currentEntryId");
      const confettiContainer = document.getElementById("confettiContainer");

      // Botões
      const startBtn = document.getElementById("startBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const newEntryBtn = document.getElementById("newEntryBtn");
      const cancelEntryBtn = document.getElementById("cancelEntryBtn");
      const saveEntryBtn = document.getElementById("saveEntryBtn");

      // Inputs
      const loginEmail = document.getElementById("loginEmail");
      const loginPassword = document.getElementById("loginPassword");

      // Dados do usuário e entradas
      let currentUser = null;
      let userEntries = [];

      // Navegação
      startBtn.onclick = () => {
        intro.classList.add("hidden");
        loginForm.classList.remove("hidden");
      };

      // Logout
      logoutBtn.onclick = () => {
        currentUser = null;
        userEntries = [];
        intro.classList.remove("hidden");
        loginForm.classList.add("hidden");
        dashboard.classList.add("hidden");
      };

      // Modal de registro
      newEntryBtn.onclick = () => {
        modalTitle.textContent = "Novo Registro";
        entryText.value = "";
        currentEntryId.value = "";
        entryModal.classList.remove("hidden");
      };

      cancelEntryBtn.onclick = () => {
        entryModal.classList.add("hidden");
      };

      // Função para adicionar entrada à UI
      function addEntryToUI(entry) {
        // Se for a primeira entrada, remove a mensagem de "Nenhum registro encontrado"
        if (entriesList.innerHTML.includes('Nenhum registro encontrado')) {
          entriesList.innerHTML = '';
        }
        
        const entryDiv = document.createElement("div");
        entryDiv.classList.add(
          "bg-secondary",
          "rounded-md",
          "p-3",
          "mb-3",
          "shadow-sm",
          "text-gray-800",
          "relative"
        );
        
        const date = entry.createdAt
          ? new Date(entry.createdAt).toLocaleString()
          : "Data desconhecida";
        
        entryDiv.innerHTML = `
          <p class="mb-2">${entry.text}</p>
          <small class="block text-gray-600 mb-3">${date}</small>
          <div class="flex justify-end gap-2">
            <button class="edit-btn px-3 py-1 bg-yellow-500 text-white rounded-full text-sm hover:bg-yellow-600 transition" data-id="${entry.id}">
              Editar
            </button>
            <button class="delete-btn px-3 py-1 bg-red-500 text-white rounded-full text-sm hover:bg-red-600 transition" data-id="${entry.id}">
              Excluir
            </button>
          </div>
        `;
        
        // Adiciona no topo da lista
        entriesList.insertBefore(entryDiv, entriesList.firstChild);
        
        // Adiciona eventos aos botões
        entryDiv.querySelector('.edit-btn').addEventListener('click', (e) => editEntry(e.target.getAttribute('data-id')));
        entryDiv.querySelector('.delete-btn').addEventListener('click', (e) => deleteEntry(e.target.getAttribute('data-id')));
      }

      // Salvar registro (criação ou edição)
      saveEntryBtn.onclick = async () => {
        const text = entryText.value.trim();
        if (!text) {
          alert("O registro não pode estar vazio.");
          return;
        }

        if (!currentUser) {
          alert("Usuário não autenticado.");
          return;
        }

        try {
          // Carrega todas as entradas
          const allEntries = JSON.parse(localStorage.getItem('diario_entries') || '[]');
          
          // Se tiver um ID, estamos editando
          if (currentEntryId.value) {
            const entryIndex = allEntries.findIndex(e => e.id === currentEntryId.value);
            if (entryIndex !== -1) {
              allEntries[entryIndex] = {
                ...allEntries[entryIndex],
                text: text,
                updatedAt: new Date().toISOString()
              };
              
              localStorage.setItem('diario_entries', JSON.stringify(allEntries));
              
              // Atualiza a entrada na UI
              const entryElement = document.querySelector(`.edit-btn[data-id="${currentEntryId.value}"]`)?.closest('div.bg-secondary');
              if (entryElement) {
                entryElement.querySelector('p').textContent = text;
                entryElement.querySelector('small').textContent = 'Editado agora';
              }
            }
          } else {
            // Caso contrário, estamos criando um novo
            const newEntry = {
              id: Date.now().toString(),
              userId: currentUser.id,
              text,
              createdAt: new Date().toISOString(),
            };
            
            allEntries.push(newEntry);
            localStorage.setItem('diario_entries', JSON.stringify(allEntries));
            
            // Adiciona localmente para resposta imediata
            addEntryToUI(newEntry);
          }

          entryModal.classList.add("hidden");
          createConfetti();
          
        } catch (error) {
          alert("Erro ao salvar registro: " + error.message);
          console.error(error);
          // Recarrega as entradas em caso de erro
          loadEntries();
        }
      };

      // Carregar registros
      function loadEntries() {
        try {
          const allEntries = JSON.parse(localStorage.getItem('diario_entries') || '[]');
          userEntries = allEntries.filter(entry => entry.userId === currentUser.id);
          
          entriesList.innerHTML = "";

          if (userEntries.length === 0) {
            entriesList.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhum registro encontrado. Comece adicionando um novo!</p>';
            return;
          }

          // Ordena por data (mais recente primeiro)
          userEntries.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          
          userEntries.forEach(entry => {
            addEntryToUI(entry);
          });

        } catch (error) {
          console.error("Erro ao carregar registros:", error);
          entriesList.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhum registro encontrado. Comece adicionando um novo!</p>';
        }
      }

      // Editar registro
      function editEntry(entryId) {
        try {
          const entry = userEntries.find(e => e.id === entryId);
          if (entry) {
            modalTitle.textContent = "Editar Registro";
            entryText.value = entry.text;
            currentEntryId.value = entryId;
            entryModal.classList.remove("hidden");
          } else {
            alert("Registro não encontrado.");
          }
        } catch (error) {
          alert("Erro ao carregar registro para edição: " + error.message);
          console.error(error);
        }
      }

      // Excluir registro
      function deleteEntry(entryId) {
        if (confirm("Tem certeza que deseja excluir este registro? Esta ação não pode ser desfeita.")) {
          try {
            // Remove visualmente primeiro
            const entryElement = document.querySelector(`.delete-btn[data-id="${entryId}"]`)?.closest('div.bg-secondary');
            if (entryElement) {
              entryElement.remove();
            }
            
            // Remove dos dados
            const allEntries = JSON.parse(localStorage.getItem('diario_entries') || '[]');
            const updatedEntries = allEntries.filter(e => e.id !== entryId);
            localStorage.setItem('diario_entries', JSON.stringify(updatedEntries));
            
            // Se não houver mais entradas, mostra a mensagem padrão
            if (entriesList.children.length === 0) {
              entriesList.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhum registro encontrado. Comece adicionando um novo!</p>';
            }
          } catch (error) {
            console.error("Erro ao excluir registro:", error);
            loadEntries();
          }
        }
      }

      // Confetes
      function createConfetti() {
        const colors = ["#A2D5AB", "#2F3C7E", "#D8D4F2", "#F9D67A"];
        for (let i = 0; i < 30; i++) {
          const confetti = document.createElement("div");
          confetti.classList.add("confetti");
          confetti.style.left = Math.random() * window.innerWidth + "px";
          confetti.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDuration = 2 + Math.random() * 3 + "s";
          confetti.style.width = confetti.style.height =
            5 + Math.random() * 8 + "px";
          confettiContainer.appendChild(confetti);

          confetti.addEventListener("animationend", () => {
            confetti.remove();
          });
        }
      }
    </script>
  </body>
</html>